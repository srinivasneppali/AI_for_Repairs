# WM_SA_NO_SPIN_V2_MODULAR
meta:
  id: WM_SA_NO_SPIN_V2
  title: "DIAGNOSTIC-TEST-V4: WM Semi-Automatic: Spin Not Working (Modular)"
  version: "2.0"
  language:
    - en
  gating:
    require_all_steps: true
    generate_token: true
    token_pattern: "{FAULT}-{SKU}-{RAND5}"

start: s1_load_balance_check

steps:

  # ==========================================
  # ### MODULE 1: PRELIMINARY CHECKS ###
  # ==========================================
  - id: s1_load_balance_check
    type: action
    prompt:
      en: >
        Step 1: Load Balance Check. Open the spin lid. Check for unevenly dumped
        clothes OR a small cloth (sock/handkerchief) fallen between the tub and
        outer body.
    ui:
      control: radio
      options:
        - "Clothes were uneven -> Spread evenly"
        - "Small cloth was jamming the drum -> Removed"
        - "No issue found with load balance"
    evidence:
      required: true
      capture: photo
    require_pass: true
    validation:
      confirm_required: true
    branches:
      - when: "selection == 'No issue found with load balance'"
        next: s2_brake_wire_intro
    next: s2_brake_wire_intro

  # ==========================================
  # ### MODULE 2: BRAKE SYSTEM ###
  # ==========================================
  - id: s2_brake_wire_intro
    type: quiz
    prompt:
      en: "Step 2: Brake Cable Check. Open the back panel to proceed."
    ui:
      control: radio
      options:
        - "Panel Open. Proceed."
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'Panel Open. Proceed.'"
        next: s2_check_brake_wire_action

  - id: s2_check_brake_wire_action
    type: quiz
    prompt:
      en: >
        Does the brake wire correctly pull and release the brake band when the lid is closed?
    ui:
      control: radio
      options:
        - "Yes, works correctly"
        - "No, cable is loose/broken"
    evidence:
      required: true
      capture: photo
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'Yes, works correctly'"
        next: s3_safety_switch_check
      - when: "selection == 'No, cable is loose/broken'"
        next: s2_fix_or_replace_brake
    next: s3_safety_switch_check

  - id: s2_fix_or_replace_brake
    type: action
    prompt:
      en: "Tighten the cable. If broken, mark for replacement."
    ui:
      control: radio
      options:
        - "Tightened and fixed (Spin works now)"
        - "Cable is broken (Needs replacement)"
    require_pass: true
    branches:
      - when: "selection == 'Tightened and fixed (Spin works now)'"
        next: null # Resolved
      - when: "selection == 'Cable is broken (Needs replacement)'"
        next: s2_log_brake_fault
    next: null

  - id: s2_log_brake_fault
    type: photo
    prompt:
      en: "Capture photo of broken Brake Wire. (Flow will continue to check other parts)."
    ui:
      control: none
    evidence:
      required: true
      capture: photo
    recommends_part: "Brake Wire"
    recommends_parts:
      - "Brake Wire"
    # LOGIC UPDATE: Even if brake is broken, we check Switch/Capacitor visually
    next: s3_safety_switch_check

  # ==========================================
  # ### MODULE 3: SAFETY SWITCH ###
  # ==========================================
  - id: s3_safety_switch_check
    type: quiz
    prompt:
      en: >
        Step 3: Safety Switch Check. Inspect contacts near the hinge.
        Are they carbonized, broken, or clean?
    ui:
      control: radio
      options:
        - "Contacts Clean & Touching (Good)"
        - "Carbon/Rust present (Needs Cleaning)"
        - "Contacts Bent/Broken (Needs Replacement)"
    evidence:
      required: true
      capture: photo
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'Contacts Clean & Touching (Good)'"
        next: s4_rat_bite_check
      - when: "selection == 'Carbon/Rust present (Needs Cleaning)'"
        next: s3_clean_switch
      - when: "selection == 'Contacts Bent/Broken (Needs Replacement)'"
        next: s3_log_switch_fault
    next: s4_rat_bite_check

  - id: s3_clean_switch
    type: action
    prompt:
      en: "Clean contacts with sandpaper. Does spin work now?"
    ui:
      control: radio
      options:
        - "Yes, spin working"
        - "No, issue persists (Replace Switch)"
    require_pass: true
    branches:
      - when: "selection == 'Yes, spin working'"
        next: null
      - when: "selection == 'No, issue persists (Replace Switch)'"
        next: s3_log_switch_fault
    next: null

  - id: s3_log_switch_fault
    type: photo
    prompt:
      en: "Capture photo of faulty Safety Switch. (Flow will continue to check Capacitor)."
    ui:
      control: none
    evidence:
      required: true
      capture: photo
    recommends_part: "Safety Switch"
    recommends_parts:
      - "Safety Switch"
    # LOGIC UPDATE: Daisy chain to next inspection
    next: s5_capacitor_check

  # ==========================================
  # ### MODULE 4: WIRING HARNESS ###
  # ==========================================
  # Note: Skipped if Switch was bad to save time, or we can force check.
  # Linked from s3 "Good" path.
  - id: s4_rat_bite_check
    type: quiz
    prompt:
      en: "Step 4: Rat Bite Check. Are wires cut?"
    ui:
      control: radio
      options:
        - "No, wires intact"
        - "Yes, damaged"
    evidence:
      required: true
      capture: photo
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'No, wires intact'"
        next: s5_capacitor_check
      - when: "selection == 'Yes, damaged'"
        next: s4_repair_wires
    next: s5_capacitor_check

  - id: s4_repair_wires
    type: action
    prompt:
      en: "Repair/Tape wires. Does spin work?"
    ui:
      control: radio
      options:
        - "Yes, spin working"
        - "No, damage too heavy (Replace Harness)"
    require_pass: true
    branches:
      - when: "selection == 'Yes, spin working'"
        next: null
      - when: "selection == 'No, damage too heavy (Replace Harness)'"
        next: s4_log_harness_fault
    next: null

  - id: s4_log_harness_fault
    type: photo
    prompt:
      en: "Capture photo of damaged Harness."
    ui:
      control: none
    evidence:
      required: true
      capture: photo
    recommends_part: "Main Wiring Harness"
    recommends_parts:
      - "Main Wiring Harness"
    next: s5_capacitor_check

  # ==========================================
  # ### MODULE 5: CAPACITOR ###
  # ==========================================
  - id: s5_capacitor_check
    type: quiz
    prompt:
      en: >
        Step 5: Capacitor Check. Is it swollen/burst OR is motor humming?
    ui:
      control: radio
      options:
        - "No, looks fine / No humming"
        - "Yes, Swollen/Burst/Humming"
    evidence:
      required: true
      capture: photo
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'No, looks fine / No humming'"
        next: s6_timer_check
      - when: "selection == 'Yes, Swollen/Burst/Humming'"
        next: s5_log_capacitor_fault
    next: s6_timer_check

  - id: s5_log_capacitor_fault
    type: photo
    prompt:
      en: "Capture photo of Capacitor Rating (e.g., 5MFD)."
    ui:
      control: none
    evidence:
      required: true
      capture: photo
    recommends_part: "Capacitor"
    recommends_parts:
      - "Capacitor"
    # LOGIC UPDATE: Daisy chain to End Order
    next: end_flow_parts_order

  # ==========================================
  # ### MODULE 6: TIMER & MOTOR (Brief) ###
  # ==========================================
  - id: s6_timer_check
    type: quiz
    prompt:
      en: "Step 6: Timer Check. Does it tick and move?"
    ui:
      control: radio
      options:
        - "Yes, working"
        - "No, stuck/silent"
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'Yes, working'"
        next: end_unresolved
      - when: "selection == 'No, stuck/silent'"
        next: s6_log_timer_fault
    next: end_unresolved

  - id: s6_log_timer_fault
    type: photo
    prompt:
      en: "Capture photo of Timer."
    ui:
      control: none
    recommends_part: "Spin Timer"
    recommends_parts:
      - "Spin Timer"
    next: end_flow_parts_order

  # ==========================================
  # ### MODULE 7: FINALIZE ###
  # ==========================================
  - id: end_flow_parts_order
    type: note
    prompt:
      en: >
        Faults identified. Please proceed to generate the Gate Token for the
        recommended parts (e.g., Switch, Capacitor).
    ui:
      control: none
    next: null

  - id: end_unresolved
    type: note
    prompt:
      en: >
        Flow completed. No specific parts identified. Consult Expert.
    ui:
      control: none
    next: null# WM_SA_NO_SPIN_V2_MODULAR
meta:
  id: WM_SA_NO_SPIN_V2
  title: "DIAGNOSTIC-TEST-V4: WM Semi-Automatic: Spin Not Working (Modular)"
  version: "2.0"
  language:
    - en
  gating:
    require_all_steps: true
    generate_token: true
    token_pattern: "{FAULT}-{SKU}-{RAND5}"

start: s1_load_balance_check

steps:

  # ==========================================
  # ### MODULE 1: PRELIMINARY CHECKS ###
  # ==========================================
  - id: s1_load_balance_check
    type: action
    prompt:
      en: >
        Step 1: Load Balance Check. Open the spin lid. Check for unevenly dumped
        clothes OR a small cloth (sock/handkerchief) fallen between the tub and
        outer body.
    ui:
      control: radio
      options:
        - "Clothes were uneven -> Spread evenly"
        - "Small cloth was jamming the drum -> Removed"
        - "No issue found with load balance"
    evidence:
      required: true
      capture: photo
    require_pass: true
    validation:
      confirm_required: true
    branches:
      - when: "selection == 'No issue found with load balance'"
        next: s2_brake_wire_intro
    next: s2_brake_wire_intro

  # ==========================================
  # ### MODULE 2: BRAKE SYSTEM ###
  # ==========================================
  - id: s2_brake_wire_intro
    type: quiz
    prompt:
      en: "Step 2: Brake Cable Check. Open the back panel to proceed."
    ui:
      control: radio
      options:
        - "Panel Open. Proceed."
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'Panel Open. Proceed.'"
        next: s2_check_brake_wire_action

  - id: s2_check_brake_wire_action
    type: quiz
    prompt:
      en: >
        Does the brake wire correctly pull and release the brake band when the lid is closed?
    ui:
      control: radio
      options:
        - "Yes, works correctly"
        - "No, cable is loose/broken"
    evidence:
      required: true
      capture: photo
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'Yes, works correctly'"
        next: s3_safety_switch_check
      - when: "selection == 'No, cable is loose/broken'"
        next: s2_fix_or_replace_brake
    next: s3_safety_switch_check

  - id: s2_fix_or_replace_brake
    type: action
    prompt:
      en: "Tighten the cable. If broken, mark for replacement."
    ui:
      control: radio
      options:
        - "Tightened and fixed (Spin works now)"
        - "Cable is broken (Needs replacement)"
    require_pass: true
    branches:
      - when: "selection == 'Tightened and fixed (Spin works now)'"
        next: null # Resolved
      - when: "selection == 'Cable is broken (Needs replacement)'"
        next: s2_log_brake_fault
    next: null

  - id: s2_log_brake_fault
    type: photo
    prompt:
      en: "Capture photo of broken Brake Wire. (Flow will continue to check other parts)."
    ui:
      control: none
    evidence:
      required: true
      capture: photo
    recommends_part: "Brake Wire"
    recommends_parts:
      - "Brake Wire"
    # LOGIC UPDATE: Even if brake is broken, we check Switch/Capacitor visually
    next: s3_safety_switch_check

  # ==========================================
  # ### MODULE 3: SAFETY SWITCH ###
  # ==========================================
  - id: s3_safety_switch_check
    type: quiz
    prompt:
      en: >
        Step 3: Safety Switch Check. Inspect contacts near the hinge.
        Are they carbonized, broken, or clean?
    ui:
      control: radio
      options:
        - "Contacts Clean & Touching (Good)"
        - "Carbon/Rust present (Needs Cleaning)"
        - "Contacts Bent/Broken (Needs Replacement)"
    evidence:
      required: true
      capture: photo
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'Contacts Clean & Touching (Good)'"
        next: s4_rat_bite_check
      - when: "selection == 'Carbon/Rust present (Needs Cleaning)'"
        next: s3_clean_switch
      - when: "selection == 'Contacts Bent/Broken (Needs Replacement)'"
        next: s3_log_switch_fault
    next: s4_rat_bite_check

  - id: s3_clean_switch
    type: action
    prompt:
      en: "Clean contacts with sandpaper. Does spin work now?"
    ui:
      control: radio
      options:
        - "Yes, spin working"
        - "No, issue persists (Replace Switch)"
    require_pass: true
    branches:
      - when: "selection == 'Yes, spin working'"
        next: null
      - when: "selection == 'No, issue persists (Replace Switch)'"
        next: s3_log_switch_fault
    next: null

  - id: s3_log_switch_fault
    type: photo
    prompt:
      en: "Capture photo of faulty Safety Switch. (Flow will continue to check Capacitor)."
    ui:
      control: none
    evidence:
      required: true
      capture: photo
    recommends_part: "Safety Switch"
    recommends_parts:
      - "Safety Switch"
    # LOGIC UPDATE: Daisy chain to next inspection
    next: s5_capacitor_check

  # ==========================================
  # ### MODULE 4: WIRING HARNESS ###
  # ==========================================
  # Note: Skipped if Switch was bad to save time, or we can force check.
  # Linked from s3 "Good" path.
  - id: s4_rat_bite_check
    type: quiz
    prompt:
      en: "Step 4: Rat Bite Check. Are wires cut?"
    ui:
      control: radio
      options:
        - "No, wires intact"
        - "Yes, damaged"
    evidence:
      required: true
      capture: photo
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'No, wires intact'"
        next: s5_capacitor_check
      - when: "selection == 'Yes, damaged'"
        next: s4_repair_wires
    next: s5_capacitor_check

  - id: s4_repair_wires
    type: action
    prompt:
      en: "Repair/Tape wires. Does spin work?"
    ui:
      control: radio
      options:
        - "Yes, spin working"
        - "No, damage too heavy (Replace Harness)"
    require_pass: true
    branches:
      - when: "selection == 'Yes, spin working'"
        next: null
      - when: "selection == 'No, damage too heavy (Replace Harness)'"
        next: s4_log_harness_fault
    next: null

  - id: s4_log_harness_fault
    type: photo
    prompt:
      en: "Capture photo of damaged Harness."
    ui:
      control: none
    evidence:
      required: true
      capture: photo
    recommends_part: "Main Wiring Harness"
    recommends_parts:
      - "Main Wiring Harness"
    next: s5_capacitor_check

  # ==========================================
  # ### MODULE 5: CAPACITOR ###
  # ==========================================
  - id: s5_capacitor_check
    type: quiz
    prompt:
      en: >
        Step 5: Capacitor Check. Is it swollen/burst OR is motor humming?
    ui:
      control: radio
      options:
        - "No, looks fine / No humming"
        - "Yes, Swollen/Burst/Humming"
    evidence:
      required: true
      capture: photo
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'No, looks fine / No humming'"
        next: s6_timer_check
      - when: "selection == 'Yes, Swollen/Burst/Humming'"
        next: s5_log_capacitor_fault
    next: s6_timer_check

  - id: s5_log_capacitor_fault
    type: photo
    prompt:
      en: "Capture photo of Capacitor Rating (e.g., 5MFD)."
    ui:
      control: none
    evidence:
      required: true
      capture: photo
    recommends_part: "Capacitor"
    recommends_parts:
      - "Capacitor"
    # LOGIC UPDATE: Daisy chain to End Order
    next: end_flow_parts_order

  # ==========================================
  # ### MODULE 6: TIMER & MOTOR (Brief) ###
  # ==========================================
  - id: s6_timer_check
    type: quiz
    prompt:
      en: "Step 6: Timer Check. Does it tick and move?"
    ui:
      control: radio
      options:
        - "Yes, working"
        - "No, stuck/silent"
    require_pass: true
    resolution_prompt: false
    branches:
      - when: "selection == 'Yes, working'"
        next: end_unresolved
      - when: "selection == 'No, stuck/silent'"
        next: s6_log_timer_fault
    next: end_unresolved

  - id: s6_log_timer_fault
    type: photo
    prompt:
      en: "Capture photo of Timer."
    ui:
      control: none
    recommends_part: "Spin Timer"
    recommends_parts:
      - "Spin Timer"
    next: end_flow_parts_order

  # ==========================================
  # ### MODULE 7: FINALIZE ###
  # ==========================================
  - id: end_flow_parts_order
    type: note
    prompt:
      en: >
        Faults identified. Please proceed to generate the Gate Token for the
        recommended parts (e.g., Switch, Capacitor).
    ui:
      control: none
    next: null

  - id: end_unresolved
    type: note
    prompt:
      en: >
        Flow completed. No specific parts identified. Consult Expert.
    ui:
      control: none
    next: null