# -----------------------------------------------------------------------------
# YAML conventions & editing guidelines
# -----------------------------------------------------------------------------
# - meta contains identifiers, human title, and flow gating rules.
# - start defines the first step id; keep ids stable because other systems reference them.
# - steps form a directed flow. Each step id must be unique and branch targets must exist.
# - prompts use folded scalars (>) for readability; keep messaging short, factual, and ASCII only.
# - when adding new steps, follow the existing comment headers so later edits stay organized.
# -----------------------------------------------------------------------------

meta:
  id: WM_WASH_NOT_WORKING_V1
  title: "DIAGNOSTIC: WM - Wash Not Working (Full Daisy Chain)"
  version: "1"
  language:
    - en
  gating:
    require_all_steps: true
    generate_token: true
    token_pattern: "{FAULT}-{SKU}-{RAND5}"

start: s1_ac_input_check

# -----------------------------------------------------------------------------
# Step flow overview
# -----------------------------------------------------------------------------
steps:
  # Step 1 - AC input check
  - id: s1_ac_input_check
    type: quiz
    prompt:
      en: >
        Step 1 - AC input: Measure voltage at the customer socket feeding the washing machine
        (PN 220-240V AC, NE <5V, PE 220-240V).
    ui:
      control: radio
      options:
        - AC voltage and earthing within spec
        - AC voltage / earthing out of spec - external wiring issue
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "AC voltage / earthing out of spec - external wiring issue"
        next: s1_log_ac_input_issue
    next: s2_machine_type_select

  - id: s1_log_ac_input_issue
    type: photo
    prompt:
      en: >
        AC supply or earthing is not OK. Inform customer to correct wiring with an electrician
        before further diagnosis.
    ui:
      control: none
    next: end_flow_summary

  # Step 2 - Machine type selector
  - id: s2_machine_type_select
    type: quiz
    prompt:
      en: >
        Step 2 - Select washing machine type for the "Wash Not Working" troubleshooting flow.
    ui:
      control: radio
      options:
        - Semi Automatic WM
        - Top Load WM
        - Front Load WM
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "Semi Automatic WM"
        next: s2_sa_wash_timer_check
      - when: selection == "Top Load WM"
        next: s2_tl_fl_pcb_power_check
      - when: selection == "Front Load WM"
        next: s2_tl_fl_pcb_power_check
    next: s2_tl_fl_pcb_power_check

  # Step 2A - Semi Automatic wash timer
  - id: s2_sa_wash_timer_check
    type: quiz
    prompt:
      en: >
        Step 2A - Semi Automatic: Run the wash program and observe wash timer rotation and ticking.
    ui:
      control: radio
      options:
        - Wash timer stuck / no rotation / no sound
        - Wash timer OK but wash motor not running
        - After timer check, wash started working (issue resolved)
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "Wash timer stuck / no rotation / no sound"
        next: s2_sa_log_wash_timer_fault
      - when: selection == "Wash timer OK but wash motor not running"
        next: s3_water_inlet_and_level
      - when: selection == "After timer check, wash started working (issue resolved)"
        next: end_flow_summary
    next: s3_water_inlet_and_level

  - id: s2_sa_log_wash_timer_fault
    type: photo
    prompt:
      en: >
        Wash timer is faulty - stuck or not moving during the program.
    ui:
      control: none
    recommends_parts:
      - Wash Timer
    next: end_flow_summary

  # Step 2B - TL/FL PCB power state
  - id: s2_tl_fl_pcb_power_check
    type: quiz
    prompt:
      en: >
        Step 2B - Top / Front Load: Check main PCB power. Switch ON, start a quick program, and
        verify display along with 230V AC at the PCB input.
    ui:
      control: radio
      options:
        - PCB OFF and no 230V at PCB input (power not reaching PCB)
        - 230V present at PCB input but PCB not powering ON
        - PCB powers ON and indicators / display OK
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "PCB OFF and no 230V at PCB input (power not reaching PCB)"
        next: s2_log_power_path_fault
      - when: selection == "230V present at PCB input but PCB not powering ON"
        next: s2_log_main_pcb_fault
      - when: selection == "PCB powers ON and indicators / display OK"
        next: s3_water_inlet_and_level
    next: s3_water_inlet_and_level

  - id: s2_log_power_path_fault
    type: photo
    prompt:
      en: >
        Power cord, EMI filter, or input harness is faulty - PCB is not getting 230V AC.
    ui:
      control: none
    recommends_parts:
      - Power Cord or Plug
      - EMI Filter
      - Input Harness
    next: end_flow_summary

  - id: s2_log_main_pcb_fault
    type: photo
    prompt:
      en: >
        Main PCB receives 230V AC but does not power ON (no LEDs or display output).
    ui:
      control: none
    recommends_parts:
      - Main PCB
    next: end_flow_summary

  # Step 3 - Water inlet and level
  - id: s3_water_inlet_and_level
    type: quiz
    prompt:
      en: >
        Step 3 - Water inlet: Open tap, check water entering the drum, and measure AC at the inlet
        valve when the machine calls for water.
    ui:
      control: radio
      options:
        - No or weak water flow and 220-240V present at inlet valve coil
        - No water flow and 0V at inlet valve during fill
        - Tap pressure low but valve and voltages OK
        - Water enters normally and water level looks OK
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "No or weak water flow and 220-240V present at inlet valve coil"
        next: s3_log_inlet_valve_fault
      - when: selection == "No water flow and 0V at inlet valve during fill"
        next: s3_log_pcb_inlet_output_fault
      - when: selection == "Tap pressure low but valve and voltages OK"
        next: s3_log_low_water_pressure
      - when: selection == "Water enters normally and water level looks OK"
        next: s4_pressure_sensor_path
    next: s4_pressure_sensor_path

  - id: s3_log_inlet_valve_fault
    type: photo
    prompt:
      en: >
        Inlet valve is energized (220-240V at coil) but no water enters the drum or coil resistance is
        out of specification / burnt.
    ui:
      control: none
    recommends_parts:
      - Inlet Valve
    next: end_flow_summary

  - id: s3_log_pcb_inlet_output_fault
    type: photo
    prompt:
      en: >
        PCB is not sending AC output to the inlet valve during the fill command, though the input
        supply path is OK.
    ui:
      control: none
    recommends_parts:
      - Main PCB
      - Inlet Valve Harness
    next: end_flow_summary

  - id: s3_log_low_water_pressure
    type: photo
    prompt:
      en: >
        External tap pressure is low or irregular; machine and inlet valve are normal (customer issue).
    ui:
      control: none
    next: end_flow_summary

  # Step 4 - Pressure sensor and hose
  - id: s4_pressure_sensor_path
    type: quiz
    prompt:
      en: >
        Step 4 - Pressure sensor and hose: Inspect hose for damage or clog, check 3-5V DC supply at
        the sensor, and confirm harness continuity.
    ui:
      control: radio
      options:
        - Pressure hose damaged / cracked / rat bite / air leak
        - Hose clogged but cleaned and refitted; level now OK
        - No 3-5V DC supply from PCB at pressure sensor connector
        - Harness between PCB and sensor damaged or open
        - Supply OK but sensor output abnormal or not changing
        - Drum or tub damaged or leaking at pressure port
        - All checks OK but wash still not starting
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "Pressure hose damaged / cracked / rat bite / air leak"
        next: s4_log_pressure_hose_fault
      - when: selection == "Hose clogged but cleaned and refitted; level now OK"
        next: s5_door_lid_lock_path
      - when: selection == "No 3-5V DC supply from PCB at pressure sensor connector"
        next: s4_log_pcb_waterlevel_fault
      - when: selection == "Harness between PCB and sensor damaged or open"
        next: s4_log_waterlevel_harness_fault
      - when: selection == "Supply OK but sensor output abnormal or not changing"
        next: s4_log_pressure_sensor_fault
      - when: selection == "Drum or tub damaged or leaking at pressure port"
        next: s4_log_drum_air_leak_fault
      - when: selection == "All checks OK but wash still not starting"
        next: s5_door_lid_lock_path
    next: s5_door_lid_lock_path

  - id: s4_log_pressure_hose_fault
    type: photo
    prompt:
      en: >
        Pressure hose or sensor pipe is physically damaged or leaking air.
    ui:
      control: none
    recommends_parts:
      - Pressure Hose or Sensor Pipe
    next: end_flow_summary

  - id: s4_log_pcb_waterlevel_fault
    type: photo
    prompt:
      en: >
        PCB is not providing the required 3-5V DC supply to the pressure sensor.
    ui:
      control: none
    recommends_parts:
      - Main PCB
    next: end_flow_summary

  - id: s4_log_waterlevel_harness_fault
    type: photo
    prompt:
      en: >
        Harness between PCB and pressure sensor is open, damaged, or has rat bites.
    ui:
      control: none
    recommends_parts:
      - Pressure Sensor Harness
    next: end_flow_summary

  - id: s4_log_pressure_sensor_fault
    type: photo
    prompt:
      en: >
        Pressure sensor or water level switch is faulty though hose and PCB supply are OK.
    ui:
      control: none
    recommends_parts:
      - Pressure Sensor or Level Switch
    next: end_flow_summary

  - id: s4_log_drum_air_leak_fault
    type: photo
    prompt:
      en: >
        Drum or tub air chamber / pressure port is cracked or leaking, giving wrong level signals.
    ui:
      control: none
    recommends_parts:
      - Inner Drum or Tub Assembly
    next: end_flow_summary

  # Step 5 - Door lock / lid switch
  - id: s5_door_lid_lock_path
    type: quiz
    prompt:
      en: >
        Step 5 - Door lock (FL) or lid switch (SA and TL): Check closure, latch condition, 220V
        supply to the lock, switch action, and wiring.
    ui:
      control: radio
      options:
        - Mechanical latch damaged or jammed
        - No 220V AC from PCB to door lock or lid switch
        - 220V present but lock coil or lid switch not engaging
        - Soap or detergent residue cleaned; lock now works
        - Door lock and circuit OK but wash still not starting
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "Mechanical latch damaged or jammed"
        next: s5_log_mechanical_lock_fault
      - when: selection == "No 220V AC from PCB to door lock or lid switch"
        next: s5_log_pcb_doorlock_fault
      - when: selection == "220V present but lock coil or lid switch not engaging"
        next: s5_log_doorlock_coil_fault
      - when: selection == "Soap or detergent residue cleaned; lock now works"
        next: s6_wash_motor_capacitor
      - when: selection == "Door lock and circuit OK but wash still not starting"
        next: s6_wash_motor_capacitor
    next: s6_wash_motor_capacitor

  - id: s5_log_mechanical_lock_fault
    type: photo
    prompt:
      en: >
        Mechanical door or lid latch is broken, misaligned, or jammed so the lock cannot engage.
    ui:
      control: none
    recommends_parts:
      - Door Lock or Lid Latch Assembly
    next: end_flow_summary

  - id: s5_log_pcb_doorlock_fault
    type: photo
    prompt:
      en: >
        PCB is not supplying 220V AC to the door lock or lid switch even though earlier wiring is OK.
    ui:
      control: none
    recommends_parts:
      - Main PCB
    next: end_flow_summary

  - id: s5_log_doorlock_coil_fault
    type: photo
    prompt:
      en: >
        Door lock coil or lid switch does not operate despite correct 220V AC supply from the PCB.
    ui:
      control: none
    recommends_parts:
      - Door Lock or Lid Switch Assembly
    next: end_flow_summary

  # Step 6 - Wash motor and capacitor
  - id: s6_wash_motor_capacitor
    type: quiz
    prompt:
      en: >
        Step 6 - Wash motor and capacitor: Check load, free rotation, winding resistances (or UVW
        for inverter models), and capacitor health.
    ui:
      control: radio
      options:
        - Overload or unbalanced load - after correction wash works
        - Motor shaft not rotating freely or mechanically jammed
        - Motor winding resistance out of spec / open / short
        - Inverter motor UVW resistances not equal
        - Motor hums; capacitor swollen / burst / failed
        - Motor and capacitor OK but wash still not working
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "Overload or unbalanced load - after correction wash works"
        next: end_flow_summary
      - when: selection == "Motor shaft not rotating freely or mechanically jammed"
        next: s6_log_motor_mechanical_fault
      - when: selection == "Motor winding resistance out of spec / open / short"
        next: s6_log_motor_electrical_fault
      - when: selection == "Inverter motor UVW resistances not equal"
        next: s6_log_inverter_motor_fault
      - when: selection == "Motor hums; capacitor swollen / burst / failed"
        next: s6_log_capacitor_fault
      - when: selection == "Motor and capacitor OK but wash still not working"
        next: s7_pulsator_and_belt
    next: s7_pulsator_and_belt

  - id: s6_log_motor_mechanical_fault
    type: photo
    prompt:
      en: >
        Wash motor is mechanically jammed with heavy resistance even with the belt removed.
    ui:
      control: none
    recommends_parts:
      - Wash Motor
    next: end_flow_summary

  - id: s6_log_motor_electrical_fault
    type: photo
    prompt:
      en: >
        Wash motor winding resistance does not match specification (open or short).
    ui:
      control: none
    recommends_parts:
      - Wash Motor
    next: end_flow_summary

  - id: s6_log_inverter_motor_fault
    type: photo
    prompt:
      en: >
        Inverter wash motor UVW resistances are unbalanced, indicating an internal fault.
    ui:
      control: none
    recommends_parts:
      - Inverter Wash Motor
    next: end_flow_summary

  - id: s6_log_capacitor_fault
    type: photo
    prompt:
      en: >
        Wash motor capacitor is bulged, leaking, burnt, or capacitance value is out of spec.
    ui:
      control: none
    recommends_parts:
      - Wash Motor Capacitor
    next: end_flow_summary

  # Step 7 - Pulsator / belt path
  - id: s7_pulsator_and_belt
    type: quiz
    prompt:
      en: >
        Step 7 - Pulsator or agitator and belt: Check belt condition and tension and confirm pulsator
        coupling with the gearbox.
    ui:
      control: radio
      options:
        - Belt off / loose / worn / cut
        - Motor pulley turns but pulsator free-spins or slips
        - Belt and pulsator OK but wash still not working
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "Belt off / loose / worn / cut"
        next: s7_log_belt_fault
      - when: selection == "Motor pulley turns but pulsator free-spins or slips"
        next: s7_log_pulsator_fault
      - when: selection == "Belt and pulsator OK but wash still not working"
        next: s8_drum_and_bearing
    next: s8_drum_and_bearing

  - id: s7_log_belt_fault
    type: photo
    prompt:
      en: >
        Drive belt removed, loose, cracked, or cut so torque is not transferred to the drum.
    ui:
      control: none
    recommends_parts:
      - Drive Belt
    next: end_flow_summary

  - id: s7_log_pulsator_fault
    type: photo
    prompt:
      en: >
        Pulsator or agitator splines / coupling are worn - pulsator free-spins by hand.
    ui:
      control: none
    recommends_parts:
      - Pulsator or Agitator Assembly
    next: end_flow_summary

  # Step 8 - Drum and bearing
  - id: s8_drum_and_bearing
    type: quiz
    prompt:
      en: >
        Step 8 - Drum, bearing, and spider: Rotate the drum by hand with power OFF, listen for rough
        noise, and feel resistance or rubbing.
    ui:
      control: radio
      options:
        - Bearing noise or heavy resistance when turning drum
        - Drum or spider rubbing outer tub or visibly damaged
        - Drum rotates smoothly without abnormal noise
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "Bearing noise or heavy resistance when turning drum"
        next: s8_log_bearing_fault
      - when: selection == "Drum or spider rubbing outer tub or visibly damaged"
        next: s8_log_drum_spider_fault
      - when: selection == "Drum rotates smoothly without abnormal noise"
        next: s9_clutch_gearbox
    next: s9_clutch_gearbox

  - id: s8_log_bearing_fault
    type: photo
    prompt:
      en: >
        Drum bearings are rough, noisy, or seized causing hard rotation.
    ui:
      control: none
    recommends_parts:
      - Bearing Kit
      - Seal
    next: end_flow_summary

  - id: s8_log_drum_spider_fault
    type: photo
    prompt:
      en: >
        Drum spider or inner tub is cracked or rubbing, blocking smooth wash movement.
    ui:
      control: none
    recommends_parts:
      - Drum or Spider Assembly
    next: end_flow_summary

  # Step 9 - Clutch and gearbox
  - id: s9_clutch_gearbox
    type: quiz
    prompt:
      en: >
        Step 9 - Clutch or gearbox: During wash, check if gearbox output turns with the motor. With
        power OFF, turn manually to feel slip or jam.
    ui:
      control: radio
      options:
        - Gearbox or clutch not rotating with motor (internal slip)
        - Gearbox or clutch seized or very hard to rotate
        - Clutch and gearbox appear OK but wash still not working
    require_pass: true
    resolution_prompt: false
    branches:
      - when: selection == "Gearbox or clutch not rotating with motor (internal slip)"
        next: s9_log_gearbox_fault
      - when: selection == "Gearbox or clutch seized or very hard to rotate"
        next: s9_log_gearbox_fault
      - when: selection == "Clutch and gearbox appear OK but wash still not working"
        next: s9_log_unresolved_wash_issue
    next: end_flow_summary

  - id: s9_log_gearbox_fault
    type: photo
    prompt:
      en: >
        Clutch or gearbox is slipping or jammed; torque is not passed properly to the pulsator or drum.
    ui:
      control: none
    recommends_parts:
      - Gearbox or Clutch Assembly
    next: end_flow_summary

  - id: s9_log_unresolved_wash_issue
    type: photo
    prompt:
      en: >
        All major checks done; clutch or gearbox OK but wash still not working - escalate or consider
        product replacement.
    ui:
      control: none
    next: end_flow_summary

  - id: end_flow_summary
    type: note
    prompt:
      en: >
        End of diagnostic chain for "Wash Not Working". Review findings, confirm recommended parts,
        capture final photos, and generate Gate Token if required.
    ui:
      control: none
