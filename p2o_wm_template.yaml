# p2o_wm_template.yaml
# Fill this from your WM troubleshooting doc. Keep IDs stable.
meta:
  id: "WM_<MODEL/FLOW>_V1"
  title: "WM: <Top Issue Title> — Diagnose Before Replace"
  version: "1.0"
  language: ["en","hi"]
  sku_scope: ["<SKU1>","<SKU2>"]
  sheet:
    spreadsheet_id: "<PUT_GOOGLE_SHEET_ID>"
    sheet_name: "P2O_Responses"
  drive:
    folder_id: "<PUT_DRIVE_FOLDER_ID>"
  gating:
    require_all_steps: true
    generate_token: true
    token_pattern: "{FAULT}-{SKU}-{RAND5}"
    token_field: "GateToken"

start: "pre_power_water"

steps:
  - id: "pre_power_water"
    type: "precheck"
    prompt:
      en: "Turn OFF water supply & power; relieve pressure ≥5s"
      hi: "पानी/पावर बंद करें; 5 सेकंड तक दबाव रिलीज़ करें"
    ui:
      control: "confirm"
      options: ["Done"]
    evidence:
      required: true
      capture: "photo"
      instructions:
        en: "Photo showing valve OFF and plug disconnected."
        hi: "वाल्व OFF और प्लग निकालने का फोटो।"
    require_pass: true
    validation:
      confirm_required: true
    next: "observe_leak_site"

  - id: "observe_leak_site"
    type: "quiz"
    prompt:
      en: "Where exactly is the moisture visible?"
      hi: "नमी ठीक कहाँ दिख रही है?"
    ui:
      control: "chips"
      options:
        - "Thread/seat interface"
        - "Hose outer surface crack"
        - "Inside tub only (no external leak)"
    evidence:
      required: true
      capture: "photo"
      instructions:
        en: "Close-up photo of the observed area."
        hi: "देखे गए स्थान का क्लोज-अप फोटो।"
    require_pass: true
    validation:
      one_of: ["Thread/seat interface","Hose outer surface crack"]
    next: "prep_repair"

  - id: "prep_repair"
    type: "action"
    prompt:
      en: "Inspect gasket; re-wrap male thread with 6 PTFE wraps if needed."
      hi: "गैस्केट जांचें; आवश्यकता हो तो 6 PTFE रैप्स करें।"
    ui:
      control: "radio"
      options: ["Done as instructed"]
    evidence:
      required: true
      capture: "photo"
      instructions:
        en: "Photo of gasket condition and re-wrapped thread."
        hi: "गैस्केट स्थिति और रैप्ड थ्रेड का फोटो।"
    require_pass: true
    validation:
      confirm_required: true
    next: "install_torque"

  - id: "install_torque"
    type: "measure"
    prompt:
      en: "Install and tighten within torque window (1.2–1.8 N·m)."
      hi: "टॉर्क विंडो (1.2–1.8 N·m) में कसें।"
    ui:
      control: "numeric"
      units: "N·m"
      range: [1.2, 1.8]
      decimals: 1
    evidence:
      required: true
      capture: "photo"
      instructions:
        en: "Photo of torque wrench scale or tool with final setting."
        hi: "टॉर्क स्केल/टूल का फोटो।"
    require_pass: true
    validation:
      min: 1.2
      max: 1.8
    next: "leak_test"

  - id: "leak_test"
    type: "verify"
    prompt:
      en: "Open water and perform a 60‑second leak observation."
      hi: "पानी चालू कर 60 सेकंड लीक निरीक्षण करें।"
    ui:
      control: "timer"
      seconds: 60
    evidence:
      required: true
      capture: "photo"
      instructions:
        en: "Take a photo at ~60s showing no drip at the joint."
        hi: "~60 सेकंड पर जोड़ पर बिना रिसाव का फोटो।"
    require_pass: true
    validation:
      # runner will show 'No leak observed' selection; keep it binary
      requires_selection: ["No leak observed"]
    next: "final"

  - id: "final"
    type: "note"
    prompt:
      en: "All mandatory checks passed. Gate Token will be issued."
      hi: "सभी जाँच पास। Gate Token जारी होगा।"
    ui:
      control: "none"
    evidence:
      required: false
      capture: "none"
    require_pass: false
    next: null